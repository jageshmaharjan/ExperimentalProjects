import os
import sys
import numpy as np
from numpy import dot
from numpy.linalg import norm
import operator
import json
from bert_serving.client import BertClient


def cos_sim(a, b):
    return dot(a,b)/(norm(a)*norm(b))


def read_data(file_path):
    file_path = "/home/jugs/Documents/zegal/templates/zegal_data.tsv"
    with open(file_path, "r") as fp:
        data = fp.readlines()
    return data


def get_labels_corpus(keyValPairs):
    labels = list(keyValPairs.keys())
    corpus = list(keyValPairs.values())
    return labels, corpus


def preprocess_data():
    data = read_data(file_path="")
    keyValPairs = {}
    for line in data:
        if line.split("\t")[0] not in keyValPairs:
            keyValPairs[line.split("\t")[0]] = line.split("\t")[1]
        else:
            value = keyValPairs[line.split("\t")[0]]
            keyValPairs[line.split("\t")[0]] = value + " " + line.split("\t")[1]
    labels, corpus = get_labels_corpus(keyValPairs)
    return labels, corpus

lbl, corps = preprocess_data()
print("Tested Ok!")

bc = BertClient()
encoded_corpus = bc.encode(corps)
# query = ["trade mark licence agreement  this agreement is dated  (the “agreement”).  parties   (the licensor).   (the licensee).  background  the licensor is the registered owner of the marks.  the licensor has the right to grant licences of the marks within the territory.  the licensee has requested a licence to use the marks in order to  the products.  the licensor has agreed to grant such a licence to the licensee on the terms set out in this agreement.  agreed terms  interpretation  the following definitions and rules of interpretation apply in this agreement.  marks: the trade marks registered in the register of trade marks at the trade marks registry of hong kong set out in schedule 1.  products: the goods listed in schedule 2.  royalties: the payments to be made to the licensor by the licensee under clause 4.  specifications: the specifications listed in schedule 1.  territory:   clause, schedule, and paragraph headings shall not affect the interpretation of this agreement.  the schedules form part of this agreement and shall have effect as if set out in full in the body of this agreement. any reference to this agreement includes the schedules.  unless the context otherwise requires, words in the singular shall include the plural and in the plural shall include the singular.  a reference to writing or written includes fax and e-mail.  any words following the terms including, include, in particular, for example or any similar expression shall be construed as illustrative and shall not limit the sense of the words, description, definition, phrase or term preceding those terms.  unless the context otherwise requires, a reference to one gender shall include a reference to the other genders.  grant  in consideration of the obligations undertaken by the licensee under this agreement the licensor grants to the licensee  licence to use the marks to  and market the products in accordance with the specifications and instructions given or approved by the licensor under the terms of this agreement.  term  royalties  in consideration of the rights granted by the licensor the licensee shall pay to the licensor the following sum(s):  the licensee shall within thirty (30) days of the expiration of each quarter during the subsistence of this agreement deliver to the licensor a statement giving particulars of all sales of the products effected by the licensee during the quarter and showing the total royalty payable to the licensor and at the same time deliver to the licensor a remittance for the full amount of that royalty.  the licensee shall permit the licensor or its accredited representatives from time to time to examine the licensee's books in so far as these relate to sales of the products.  licensee's obligations  the licensee shall manufacture the products according to the specifications or such other specifications as the licensor may from time to time substitute and at all times ensure that the products are of the highest quality attainable within such specifications.  the licensee shall deliver to the licensor free of charge samples of each unit of the products, including their wrappings and packaging, and shall not commence distribution of the products until it has received written approval from the licensor of their design, standard of workmanship, quality or presentation, and intrinsic merit.  the licensee shall ensure that all other units of the products, including their wrappings and packaging, of the same description as the samples correspond to the samples approved by the licensor in accordance with clause 5.2.  the licensee shall supply to the licensor free of charge such further samples of the products as the licensor may reasonably require from time to time.  the licensee shall supply to the licensor or to such other persons as the licensor shall require any of the products that the licensor may require up to the quantities and at the prices specified in schedule 2.  use and protection of the marks  the trade marks shall be used as follows:  each unit of the products for which a trade mark is specified shall display that mark in a manner approved by the licensor;  no other trade mark shall be affixed by the licensee to the products without the prior written consent of the licensor;  the licensee shall not use in relation to or affix to any goods other than the products for which such marks are specified any of the trade marks.  the licensee shall not use any of the marks as part of the licensee's name or the name of any entity associated with it without the prior written consent of the licensor.  the licensee shall not during the subsistence of this agreement or at any future time register or use any of the marks in its own name as proprietor.  the licensee recognises the licensor's title to the marks and shall not claim any right, title, or interest in the marks, save as is granted by this agreement.  the licensee shall promptly call to the attention of the licensor the use of the marks by any third party or any activity of any third party which might in the opinion of the licensee amount to an infringement of the marks.  the licensee shall not assign the benefit of this agreement or grant any sub-licence without the prior written consent of the licensor.  the licensee shall hold all goodwill generated by its operations under this agreement as bare trustee for the benefit of the licensor.  termination  this agreement will automatically terminate immediately if any of the following shall happen:  if the licensee is in breach of any of its material obligations under this agreement and, in the case of a breach capable of being remedied, fails to remedy such breach within  month of being requested by the licensor in writing to do so;  if the licensee goes into liquidation, either compulsorily or voluntarily (except for the purpose of reconstruction or amalgamation while solvent), or if a receiver, manager, trustee or administrator is appointed in respect of the whole or any part of its assets, or if the licensee makes an assignment for the benefit of or a composition with its creditors generally, or if the licensee threatens to do any of these things, or if any similar occurrence under any jurisdiction affects the licensee.  consequences of termination  subject to clause 7, on termination of this agreement, whether by expiry of the term or otherwise, except as otherwise provided in this agreement, the licensee shall discontinue all use of the marks.  recordal  the licensee shall, at its own cost and as soon as reasonably practicable, record the licence granted to it in clause 2 at the trade marks registry of hong kong against the registrations and applications listed in schedule 1 and against any applications or registrations of any marks listed in schedule 1 that are notified in writing by the licensor to the licensee after the date of this agreement.  the licensor shall provide reasonable assistance, at the licensee's cost, to enable the licensee to comply with clause 9.1.   confidentiality  each party undertakes that it shall not at any time during this agreement, and for a period of five (5) years after termination of this agreement, disclose to any person any confidential information concerning the business, affairs, customers, clients or suppliers of the other party or of any member of the group of companies to which the other party belongs, except as permitted by clause 10.2.  each party may disclose the other party's confidential information:  to its employees, officers, representatives or advisers who need to know such information for the purposes of carrying out the party's obligations under this agreement. each party shall ensure that its employees, officers, representatives or advisers to whom it discloses the other party's confidential information comply with clause 10; and  as may be required by law, a court of competent jurisdiction or any governmental or regulatory authority.  no party shall use any other party's confidential information for any purpose other than to perform its obligations under this agreement.  licensor's warranties and indemnity  the licensor warrants that:  the licensor is the owner of the marks and has full power to enter into this agreement;  the licensor has not granted any assignments by way of security, charges, or licences to use the marks;  the licensor has not either by act or omission caused or permitted anything which may endanger the registration of the marks;  the licensor will keep the licensee indemnified against all actions, claims, proceedings, costs, and damages (including any damages or compensation paid by the licensee on the advice of its legal advisers to compromise or settle any claim) and all legal costs or other expenses arising out of any breach of the above warranties or out of any claim by a third party based on any facts which if substantiated would constitute such a breach.  variation  no variation of this agreement shall be effective unless it is in writing and signed by the parties (or their authorised representatives).  waiver  a waiver of any right or remedy under this agreement or by law is only effective if given in writing and shall not be deemed a waiver of any subsequent breach or default.  a failure or delay by a party to exercise any right or remedy provided under this agreement or by law shall not constitute a waiver of that or any other right or remedy, nor shall it prevent or restrict any further exercise of that or any other right or remedy. no single or partial exercise of any right or remedy provided under this agreement or by law shall prevent or restrict the further exercise of that or any other right or remedy.  a party that waives a right or remedy provided under this agreement or by law in relation to one party, or takes or fails to take any action against that party, does not affect its rights in relation to any other party.  notices  all notices required or permitted by this agreement shall be in writing and in the english language and shall be sent to the recipient at its address set out above, or as otherwise directed by the recipient by notice given in accordance with this clause.  notices shall be delivered by hand or sent by registered post, courier or by facsimile. if delivered by hand or sent by courier, notice will be deemed given on the date of receipt, if sent by facsimile, on the date of transmission, and if sent by registered post, five (5) days after being posted.  counterparts  this agreement may be executed in any number of counterparts, each of which when executed and delivered shall constitute a duplicate original, but all the counterparts shall together constitute the one agreement.  governing law  this agreement and any dispute or claim arising out of or in connection with it or its subject matter or formation (including non-contractual disputes or claims) shall be governed by and construed in accordance with the laws of the hong kong special administrative region.  this agreement has been entered into on the date stated at the beginning of it.      schedule 1  schedule 2"]
# query = ["FREELANCE AGREEMENT THIS AGREEMENT is dated (the “Agreement”). Subject matter: The Client is hiring the Freelancer ____________ (the “Services”)2 Term: The Freelancer will start work on ____________. This Agreement will last until the work is completed, unless terminated earlier according to the terms of this Agreement. Method of payment: All payments shall be made by bank transfer to the bank account of the Freelancer indicated in the Invoice or such other payment method as agreed by the FreelancerFreelancer's responsibilities: The Freelancer will (a) provide the Services with all due care, skill and ability; and (b) keep the Client informed of the progress of the Services. The Freelancer must comply with all applicable laws, regulations and codes applicable to the performance of the Services, including those relating to anti-bribery, anti-corruption and data protection in performing the Services. Confidentiality: Each party undertakes that it will not at any time use or disclose any confidential information concerning the business, affairs, customers or suppliers of the other party, except for disclosure to its employees, officers or advisors on a need-to-know basis, or disclosure required by any law, court or governmental or regulatory authority. Warranties: The Freelancer warrants that (a) this Agreement and the performance thereof do not and will not violate any contract that applies to the Freelancer; and (b) the Works do not and will not infringe on the intellectual property rights of any third parties. The Client warrants that the use or incorporation of any material into the Works do not and will not infringe on the intellectual property rights of any third parties. Termination: Either party may terminate this Agreement by giving notice of  month. The Freelancer may terminate this Agreement immediately if the Client fails to pay the Service Charges for more than  day. Relationship: The relationship of the Freelancer to the Client will be that of independent contractor and nothing in this Agreement shall render him an employee, agent or partner of the Client. Miscellaneous: Neither party may assign or transfer any of its rights or obligations to another party without the prior written approval of the other party. This Agreement may only be amended with consent of both parties. This Agreement constitutes the entire agreement of the parties and supersedes all oral negotiations and prior writings with respect to the subject matter hereof. If any provision of this Agreement becomes invalid or unenforceable, it shall be deemed modified (to the minimum extent necessary) to make it valid and enforceable, or where such modification is not possible, deemed deleted and shall not affect the validity and enforceability of the remaining provisions. Interpretation: A reference to a person includes a natural person, a corporation, or an unincorporated body (whether or not having a separate legal personality). A reference to writing or written includes fax and e-mail. A reference to one gender shall include a reference to the other genders. Governing law: This Agreement and any dispute or claim arising out of or in connection with it or its subject matter or formation (including non-contractual disputes or claims) shall be governed by and construed in accordance with the laws of the Hong Kong Special Administrative Region. This Agreement has been entered into on the date stated at the beginning of it."]
query = ["protectection for shareholder rights"]
print("query:  " + query[0])
q_embed = bc.encode(query)
for i, line in enumerate(encoded_corpus):
    scores = cos_sim(q_embed, line)
    print(lbl[i])
    print(scores)